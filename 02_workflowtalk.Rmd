---
title: "Project management and workflow"
author: Remko Duursma
date: 5 March 2020
output: ioslides_presentation
---


## Reproducible research

1. Reproduce your results by **running a script** that contains the entire workflow
2. Outputs (figures, processed datasets) are **disposable**, your scripts can always re-produce the output
3. **Document** everything: how do I reproduce the main results? Are there settings I have to worry about? What dependencies are there?
4. Make your code **readable** by organizing it in logical sub-units (as separate scripts, and custom functions)


![](screenshots/reprresearchbook.jpg)


## A few key principles (1)

- Organize code and data in a single folder for each 'project'
- Do not mix code for separate projects
- Keep raw (original) data in a sub-folder, and **never modify raw data**
- Do not hang on to a collection of 'old' scripts, commented-out code, bits that don't work.

- Use *projects* in Rstudio to manage files and your workspace

## A few key principles (2)

- Write functions as much as possible
- Keep code that defines functions separate from other code
- Use a logical folder structure to organize files in a project

![](../screenshots/folderstructure.png)


## Project size

- Try to avoid very large projects, instead split them into more **manageable chunks**, where possible. 

- Do not write long scripts, instead split them into small scripts - each script "does one thing"

- Over time, projects always have the tendency to grow in size. If you archive old work, try to get used to: 
    + **deleting garbage** code and/or files that have accumulated
    + **completely starting over**. Sometimes it is best to reorganize your work completely.

- With version control, you have no need to hang on to old code - it can be safely deleted and always found in your *git* history if you are interested.


## Folder structure

To keep raw data separate from scripts, functions, and outputs, a good folder structure is important. Below is an example, but this is of course flexible, and depends on the type of project.  


![](../screenshots/folderstructuresmall.png)  
  
In this simple example, we keep functions and scripts in the `R` folder, the raw data files (normally as CSV) in `rawdata`, and output is sent to the `output` folder. 

The root of the project contains a "master" script that controls the entire workflow, usually calling other scripts or executing custom functions (with arguments).


## Working with folders


Do **not use absolute paths** anywhere to refer to the location of a file (there are rare exceptions to this rule). Instead, use the *working directory* (the project root) as a starting point, and find files with the relative path, for example:


```{r, eval=FALSE}
allom <- read.csv("rawdata/allometry.csv")
```

and 

```{r, eval=FALSE}
pdf("output/Figure1.pdf")
plot(height ~ diameter, data=allom)
dev.off()
```


## Calling other scripts {.smaller}

I like to have a single 'master script', that loads other scripts that do particular bits, like read and clean the raw data, make figures, and fit linear models. This script may look like the following.

```{r eval=FALSE}
# Load packages
library(gplots)
library(car)

# Load functions
source("R/functions.R")

# Read raw data and add new variables
source("R/readdata.R")

# Make figures
source("R/make_figures.R")

# Do stats
source("R/linearmodels.R")
```


## Projects in Rstudio

Finally, I strongly recommend using **projects in Rstudio**. 

- When you setup a project, a small file is added to your folder (e.g. `myproject.Rproj`)
- When you open the project, you start with a clean workspace, in the correct working directory
- So no more: `setwd()` and `rm(list=ls())` in your scripts
- This still works when you move the entire folder to a new location







